var n=(d,o,s)=>new Promise((e,t)=>{var a=i=>{try{l(s.next(i))}catch(c){t(c)}},r=i=>{try{l(s.throw(i))}catch(c){t(c)}},l=i=>i.done?e(i.value):Promise.resolve(i.value).then(a,r);l((s=s.apply(d,o)).next())});(function(){"use strict";(d=>{class o{constructor(){this._currentPageType="",this._lang=Ecwid.getStorefrontLang(),this._paymentEnabled=!1,this._sid=Ecwid.getOwnerId(),this._token=Ecwid.getAppPublicToken("laybuy-payment"),this.checkPaymentMethods=()=>{let e=new XMLHttpRequest,t=`https://app.ecwid.com/api/v3/${this._sid}/profile/paymentOptions?token=${this._token}`;e.onreadystatechange=()=>{e.readyState===4&&e.status===200&&JSON.parse(e.responseText).forEach(r=>{r.appClientId!==void 0&&r.appClientId=="laybuy-payment"&&r.enabled==!0&&(this._paymentEnabled=!0)})},e.open("GET",t),e.send()},this._addWidgetToParent=(e,t,a)=>{this._removeWidget(e);const r=a==="cart"?"tr":"div",l=document.createElement(r),i=this._getPriceFromString(t);l.className="laybuy-widget ec-header-h6",a==="cart"?l.innerHTML=`<td colspan="2"><div>${this._getLayBuyWidgetHTML(i,a)}</div></td>`:l.innerHTML=this._getLayBuyWidgetHTML(i,a),e.appendChild(l),this._addWhatsThisListener(e)},this._getLayBuyWidgetHTML=(e,t)=>{const a="laybuy-whats-this";return`<span class="laybuy-payments">${`${t==="payment"?"":"or "}6 interest-free payments of`}</span> <span class="laybuy-amount">${Ecwid.formatCurrency(e/6)}</span> <img alt="logo laybuy" class="logo-laybuy" src="https://ecwid-addons.s3.amazonaws.com/apps/ecwid-apps/laybuy-payment/logo_2023.png"> <span class="${a}">Learn more</span>`},this._removeWidget=e=>{let t=e.querySelector(".laybuy-widget");t&&t.parentNode.removeChild(t)},this._addWidgetProduct=()=>{let e=document.querySelector(".product-details__product-price");if(e){let t=e.querySelector("span.details-product-price__value");t&&this._addWidgetToParent(e,t.innerHTML,"catalog")}},this._addWidgetOnGrid=()=>{document.querySelectorAll(".grid-product .grid-product__wrap-inner").forEach(t=>{let a=t.querySelector(".grid-product__price-amount");if(a){let r=a.querySelector(".grid-product__price-value");this._addWidgetToParent(a,r.innerHTML,"catalog")}})},this._addWidgetCart=()=>{let e=document.querySelectorAll(".ec-cart-summary__body:not(.ec-cart-summary__body--wait-response)");e.forEach(t=>{this._removeWidget(t)}),e.length>0&&e[e.length-1].querySelector(".ec-cart-summary__total").childNodes.forEach(a=>{a.nodeName=="#text"&&this._addWidgetToParent(e[e.length-1],a.nodeValue,"cart")})},this._addWidgetPayment=()=>{let e=document.querySelector("label.ec-radiogroup__item.ec-radiogroup__item--app_id-laybuy-payment .ec-radiogroup__body");if(e){let t=document.querySelectorAll(".ec-cart-summary__body:not(.ec-cart-summary__body--wait-response)");t.length>0&&t[t.length-1].querySelector(".ec-cart-summary__total").childNodes.forEach(r=>{r.nodeName==="#text"&&this._addWidgetToParent(e,r.nodeValue,"payment")})}this._addPaymentSurchargeListener()},this._addPaymentSurchargeListener=()=>{document.querySelectorAll(".ec-extrafield.ec-extrafield--toggle-button input").forEach(t=>{t.removeEventListener("change",this._surchargeListenerFunc),t.addEventListener("change",this._surchargeListenerFunc)})},this._surchargeListenerFunc=()=>{setTimeout(()=>{this.waitForElement()},2e3)},this._addWhatsThisListener=(e=null)=>{let t=e?e.querySelector(".laybuy-whats-this"):document.querySelector(".laybuy-whats-this");t&&t.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();let r=document.querySelector(".laybuy-whats-this-modal");r&&(r.style.display="block")})},this._addPopup=()=>{let e=document.querySelector(".laybuy-whats-this-modal");e&&e.parentNode.removeChild(e);let t=document.createElement("div");t.className="laybuy-whats-this-modal",t.innerHTML=`<div class="laybuy-whats-this-modal--content">
                    <div class="laybuy-whats-this-modal--close">Close</div>
                    <div class="popup-container">
                        <iframe src="https://popup.laybuy.com/" frameborder="0" />
                    </div>
                </div>`,document.querySelector("body").appendChild(t);let a=document.querySelector(".laybuy-whats-this-modal"),r=document.querySelector(".laybuy-whats-this-modal--close");window.onclick=i=>{i.target===a&&a.removeAttribute("style")},r.onclick=()=>{a.style.display="none"};let l=document.querySelector(".laybuy-whats-this-modal .popup-container");l.onscroll=()=>{const i=document.querySelector(".laybuy-whats-this-modal .mobile-scrollable");l.scrollTop>5?i.style.opacity="0":i.style.opacity="1"}},this.waitForElement=()=>{let e=50,t=setInterval(()=>{e=e-1,e<0&&clearInterval(t);let a="";switch(this._currentPageType){case"CATEGORY":case"SEARCH":a=".grid__products:not(.grid__products--loading)";break;case"PRODUCT":a=".product-details__product-price";break;case"CART":a=".ec-cart-summary__body:not(.ec-cart-summary__body--wait-response) .ec-cart-summary__total";break;case"CHECKOUT_PAYMENT_DETAILS":a=".ec-cart-summary__body:not(.ec-cart-summary__body--wait-response) .ec-cart-summary__total";break;default:a="laybuy-1111";break}if(document.querySelectorAll(a).length>0&&this._paymentEnabled===!0)switch(clearInterval(t),this._addPopup(),this._currentPageType){case"CATEGORY":case"SEARCH":this._addWidgetOnGrid();break;case"PRODUCT":this._addWidgetProduct();break;case"CART":this._addWidgetCart();break;case"CHECKOUT_PAYMENT_DETAILS":this._addWidgetPayment(),this._addWidgetCart();break}},100)},this._getPriceFromString=e=>this._realParseFloat(e),this._realParseFloat=e=>(e=e.replace(/[^\d,.-]/g,""),navigator.language.substring(0,2)!=="de"&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(e)?(e=e.replace(/,/g,""),parseFloat(e)):/^-?(?:\d+|\d{1,3}(?:\.\d{3})+)(?:,\d+)?$/.test(e)?(e=e.replace(/\./g,""),e=e.replace(/,/g,"."),parseFloat(e)):(e=e.replace(/,/g,""),parseFloat(e)))}}Ecwid.OnAPILoaded.add(()=>n(this,null,function*(){let s=new o;s.checkPaymentMethods(),Ecwid.OnPageLoaded.add(e=>{switch(s._currentPageType=e.type,e.type){case"CATEGORY":case"SEARCH":setTimeout(()=>{s.waitForElement()},300);break;case"PRODUCT":s.waitForElement();break;case"CART":s.waitForElement();break;case"CHECKOUT_PAYMENT_DETAILS":s.waitForElement();break}}),Ecwid.OnProductOptionsChanged.add(e=>{setTimeout(()=>{e>0&&s.waitForElement()},300)}),Ecwid.OnCartChanged.add(()=>{s.waitForElement()})}))})()})();
